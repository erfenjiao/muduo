# 访问 Internet 上的 Web 服务器

客户端、代理服务器与百度官网

它们之间都是使用HTTP协议通信的。HTTP协议是一种应用层协议，它默认使用的传输层协议是TCP协议



## 代理服务器

什么是代理服务器？它是怎样部署的？代理服务器的功能？代理服务器的划分？

代理服务器的主要目的是代替另一台机器行事，它起到的是客户端与目标服务器之间的中转访问功能。当人们讨论代理服务器的时候，通常指的是转发代理，即前一句话提到的中转访问功能。

一个HTTP请求可能会有多个代理服务器，后面的服务器是前面服务器的上游服务器。

根据它的作用和使用方式分为三种，分别是正向代理服务器、反向代理服务器和透明代理服务器

### 正向代理服务器

正向代理/前向代理：**Forward Proxy**

代理服务器的主要目的是代替另一台机器行事，而正向代理是作为客户端的代理，它所起到的作用是代替用户去访问服务器，同时正向代理应该部署在客户端。

正向代理要求客户端自己设置代理服务器的地址，客户的每次请求都会直接发送到该代理服务器，并由代理服务器来请求目标资源，比如处于防火墙内的局域网机器要访问Internet，或者要访问一些被屏蔽掉的国外网站，就需要使用正向代理服务器。

在正向代理服务模式下，真正的服务器只知道请求来自代理服务器，不知道实际的请求来自客户端，从而隐藏了真实的客户端。

从安全角度看，代理充当了单一访问点和控制点，使用户更容易实施身份验证、SSL加密或其他安全策略，加强了用户网络中客户端计算机的安全性。

### 反向代理服务器

反向代理：**Reverse Proxy**

什么是反向代理？顾名思义，反向代理的作用与正向代理完全相反。正向代理代表客户端（或请求主机）代理，而反向代理代表服务器。反向代理代表驻扎在它后面的服务器接受来自外部客户端的请求。正向代理隐藏客户端的身份，反向代理则隐藏服务器的身份。

反向代理被设置在了服务器端，因而客户端无需任何设置。用代理服务器来接收Internet的连接请求，然后将请求转发给内部网络上的服务器，并将从内部服务器中得到的结果返回给客户端。这种情况下，代理服务器对外表现为一个真实的服务器。

各大网站通常分区域设置了多个代理服务器，所以在不同的地方ping同一个域名可能得到不同的ip地址，这些ip地址实际上就是代理服务器的ip地址。

在大多数情况下，反向代理服务器还充当其背后服务器的负载平衡器。负载均衡器在为接收大量请求的网络服务提供高可用性方面发挥着至关重要的作用。当反向代理执行负载平衡时，它会将传入的请求分发到服务器集群，所有服务器都提供相同类型的服务。



### 透明代理

*透明代理*：**Transparent Proxy**

所谓透明代理，就是客户端和服务器都感知不到代理的存在，客户端无需修改目的地址，也不需要采用代理协议连接代理服务器，所有目的地址转换都是在透明代理中完成的

透明代理只能设置在网关上，用户访问Internet的数据报必然都经过网关。



## 4.3 使用 tcpdump 抓取数据包

数据报大致分为四大部分

1. 代理服务器访问 DNS 服务器查询 www.baidu.com 的 Ip 地址                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    